# Руководство по очистке миграций

## Обзор

После завершения разработки сайта созданы чистые миграции, которые заменяют множество промежуточных миграций одной миграцией на таблицу.

## Проблемы старых миграций

- **Множественные изменения**: 30+ миграций с добавлениями/удалениями полей
- **Сложность развертывания**: Много шагов для создания базы с нуля
- **Неясная история**: Трудно понять финальную структуру таблиц
- **Дублирование**: Несколько миграций для одной таблицы

## Преимущества чистых миграций

- **Одна миграция на таблицу**: Понятная структура
- **Все поля сразу**: Финальная структура в одном месте
- **Комментарии**: Описание назначения каждого поля
- **Оптимизированные индексы**: Правильные индексы для производительности
- **Чистая история**: Легко понять структуру базы

## Структура чистых миграций

### 1. Cases (Кейсы)
- Все метрики "до" и "после"
- SEO поля
- Связи с категориями отраслей
- Индексы для производительности

### 2. Blogs (Блоги)
- Связи с категориями
- SEO поля
- Статус публикации
- Дата публикации

### 3. Blog Categories (Категории блогов)
- Цвета и иконки
- Сортировка
- Статус активности

### 4. Industry Categories (Категории отраслей)
- Аналогично категориям блогов
- Специфичные для отраслей поля

### 5. Contacts (Контакты)
- Все социальные сети
- Контактная информация
- Статус активности

### 6. Services (Услуги)
- Связанные услуги, статьи, кейсы
- SEO поля
- Цены и особенности
- Статусы отображения

### 7. FAQs (Часто задаваемые вопросы)
- Видимость на разных страницах
- Сортировка
- Статус активности

### 8. Hero Sections (Hero секции)
- Слайдер главной страницы
- Сортировка
- Статус активности

### 9. Why Us (Почему мы)
- Блоки преимуществ
- Иконки и цвета
- Сортировка

## Как применить

### Автоматически (рекомендуется)
```bash
cd database/migrations_clean
./apply_clean_migrations.sh
```

### Вручную
1. Создайте резервную копию:
   ```bash
   cp database/database.sqlite database/database_backup_$(date +%Y%m%d_%H%M%S).sqlite
   ```

2. Удалите старые миграции:
   ```bash
   rm database/migrations/2025_*.php
   ```

3. Скопируйте новые миграции:
   ```bash
   cp database/migrations_clean/2025_09_28_*.php database/migrations/
   ```

4. Сбросьте базу данных:
   ```bash
   php artisan migrate:fresh --seed
   ```

## Проверка

После применения проверьте:
- Все таблицы созданы: `php artisan db:show`
- Данные загружены: `php artisan db:seed`
- Сайт работает: `php artisan serve`

## Откат

Если что-то пошло не так:
1. Восстановите резервную копию базы данных
2. Восстановите старые миграции из backup папки
3. Выполните `php artisan migrate`

## Результат

После применения чистых миграций:
- ✅ База данных создается за один шаг
- ✅ Структура понятна и документирована
- ✅ Легко развертывать на новых серверах
- ✅ История изменений чистая
- ✅ Производительность оптимизирована
