<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;

class BlogController extends Controller
{
    // Главная страница блога
    public function index()
    {
        $articles = $this->getAllArticles();
        return view('blog.index', compact('articles'));
    }

    // SEO новости
    public function seoNews()
    {
        $articles = $this->getSeoNewsArticles();
        return view('blog.category', [
            'articles' => $articles,
            'category' => 'SEO новости',
            'categorySlug' => 'seo-news'
        ]);
    }

    // Аналитика
    public function analytics()
    {
        $articles = $this->getAnalyticsArticles();
        return view('blog.category', [
            'articles' => $articles,
            'category' => 'Аналитика',
            'categorySlug' => 'analytics'
        ]);
    }

    // Советы
    public function tips()
    {
        $articles = $this->getTipsArticles();
        return view('blog.category', [
            'articles' => $articles,
            'category' => 'Советы',
            'categorySlug' => 'tips'
        ]);
    }

    // Показать конкретную статью
    public function show($category, $slug)
    {
        $article = $this->getArticleBySlug($category, $slug);

        if (!$article) {
            abort(404);
        }

        return view('blog.article', compact('article'));
    }

    // Получить все статьи
    private function getAllArticles()
    {
        return array_merge(
            $this->getSeoNewsArticles(),
            $this->getAnalyticsArticles(),
            $this->getTipsArticles()
        );
    }

    // Статьи по SEO новостям
    private function getSeoNewsArticles()
    {
        return [
            [
                'id' => 1,
                'title' => 'Google обновил алгоритм ранжирования: что изменилось в 2024 году',
                'slug' => 'google-algorithm-update-2024',
                'category' => 'seo-news',
                'category_name' => 'SEO новости',
                'excerpt' => 'Разбираем последние изменения в алгоритме Google и их влияние на SEO-стратегии.',
                'content' => $this->getSeoNewsContent1(),
                'image' => '/images/seo-news-1.jpg',
                'published_at' => '2024-01-15',
                'reading_time' => 5
            ],
            [
                'id' => 2,
                'title' => 'Новые возможности Google Search Console: полный обзор',
                'slug' => 'google-search-console-new-features',
                'category' => 'seo-news',
                'category_name' => 'SEO новости',
                'excerpt' => 'Обзор новых функций Google Search Console и как их использовать для улучшения SEO.',
                'content' => $this->getSeoNewsContent2(),
                'image' => '/images/seo-news-2.jpg',
                'published_at' => '2024-01-10',
                'reading_time' => 7
            ],
            [
                'id' => 3,
                'title' => 'Яндекс запустил новый фактор ранжирования для мобильных устройств',
                'slug' => 'yandex-mobile-ranking-factor',
                'category' => 'seo-news',
                'category_name' => 'SEO новости',
                'excerpt' => 'Как новый фактор ранжирования Яндекса влияет на мобильную выдачу и что делать веб-мастерам.',
                'content' => $this->getSeoNewsContent3(),
                'image' => '/images/seo-news-3.jpg',
                'published_at' => '2024-01-05',
                'reading_time' => 6
            ]
        ];
    }

    // Статьи по аналитике
    private function getAnalyticsArticles()
    {
        return [
            [
                'id' => 4,
                'title' => 'Как настроить Google Analytics 4 для SEO: пошаговое руководство',
                'slug' => 'google-analytics-4-seo-setup',
                'category' => 'analytics',
                'category_name' => 'Аналитика',
                'excerpt' => 'Детальная инструкция по настройке GA4 для отслеживания SEO-метрик и конверсий.',
                'content' => $this->getAnalyticsContent1(),
                'image' => '/images/analytics-1.jpg',
                'published_at' => '2024-01-20',
                'reading_time' => 8
            ],
            [
                'id' => 5,
                'title' => 'ТОП-10 метрик для анализа эффективности SEO-кампаний',
                'slug' => 'top-10-seo-metrics',
                'category' => 'analytics',
                'category_name' => 'Аналитика',
                'excerpt' => 'Ключевые показатели, которые помогут оценить успешность вашей SEO-стратегии.',
                'content' => $this->getAnalyticsContent2(),
                'image' => '/images/analytics-2.jpg',
                'published_at' => '2024-01-18',
                'reading_time' => 6
            ],
            [
                'id' => 6,
                'title' => 'Анализ конкурентов в SEO: инструменты и методики',
                'slug' => 'seo-competitor-analysis',
                'category' => 'analytics',
                'category_name' => 'Аналитика',
                'excerpt' => 'Как правильно анализировать конкурентов и использовать полученные данные для улучшения позиций.',
                'content' => $this->getAnalyticsContent3(),
                'image' => '/images/analytics-3.jpg',
                'published_at' => '2024-01-12',
                'reading_time' => 9
            ]
        ];
    }

    // Статьи с советами
    private function getTipsArticles()
    {
        return [
            [
                'id' => 7,
                'title' => '15 простых способов ускорить загрузку сайта',
                'slug' => '15-ways-to-speed-up-website',
                'category' => 'tips',
                'category_name' => 'Советы',
                'excerpt' => 'Практические советы по оптимизации скорости загрузки сайта для улучшения SEO и пользовательского опыта.',
                'content' => $this->getTipsContent1(),
                'image' => '/images/tips-1.jpg',
                'published_at' => '2024-01-25',
                'reading_time' => 7
            ],
            [
                'id' => 8,
                'title' => 'Как написать SEO-текст, который понравится и пользователям, и поисковикам',
                'slug' => 'how-to-write-seo-text',
                'category' => 'tips',
                'category_name' => 'Советы',
                'excerpt' => 'Секреты создания качественного контента, который одновременно оптимизирован для поисковых систем.',
                'content' => $this->getTipsContent2(),
                'image' => '/images/tips-2.jpg',
                'published_at' => '2024-01-22',
                'reading_time' => 5
            ],
            [
                'id' => 9,
                'title' => 'Внутренняя перелинковка: лучшие практики для SEO',
                'slug' => 'internal-linking-best-practices',
                'category' => 'tips',
                'category_name' => 'Советы',
                'excerpt' => 'Как правильно организовать внутреннюю перелинковку для улучшения ранжирования и навигации.',
                'content' => $this->getTipsContent3(),
                'image' => '/images/tips-3.jpg',
                'published_at' => '2024-01-17',
                'reading_time' => 6
            ]
        ];
    }

    // Получить статью по slug
    private function getArticleBySlug($category, $slug)
    {
        $allArticles = $this->getAllArticles();

        foreach ($allArticles as $article) {
            if ($article['category'] === $category && $article['slug'] === $slug) {
                return $article;
            }
        }

        return null;
    }

    // Контент для SEO новостей
    private function getSeoNewsContent1()
    {
        return '
            <div class="prose max-w-none">
                <p>Google регулярно обновляет свои алгоритмы ранжирования, и 2024 год не стал исключением. В этой статье мы разберем основные изменения, которые произошли в алгоритме поисковой системы, и их влияние на SEO-стратегии.</p>

                <h2>Основные изменения в алгоритме</h2>
                <p>Главные обновления коснулись следующих аспектов:</p>
                <ul>
                    <li><strong>Качество контента</strong> - усилен фокус на экспертность, авторитетность и достоверность (E-A-T)</li>
                    <li><strong>Пользовательский опыт</strong> - Core Web Vitals стали еще более важными</li>
                    <li><strong>Мобильная оптимизация</strong> - приоритет отдается мобильно-дружественным сайтам</li>
                    <li><strong>Локальный поиск</strong> - улучшена релевантность локальных результатов</li>
                </ul>

                <h2>Как адаптироваться к изменениям</h2>
                <p>Чтобы ваш сайт соответствовал новым требованиям алгоритма, рекомендуем:</p>
                <ol>
                    <li>Регулярно проводить технический аудит сайта</li>
                    <li>Улучшать показатели Core Web Vitals</li>
                    <li>Создавать качественный, экспертный контент</li>
                    <li>Оптимизировать сайт для мобильных устройств</li>
                </ol>

                <h2>Заключение</h2>
                <p>Обновления алгоритма Google направлены на улучшение качества поисковой выдачи. Следуя рекомендациям и фокусируясь на пользовательском опыте, вы сможете поддерживать высокие позиции в поисковых результатах.</p>
            </div>
        ';
    }

    private function getSeoNewsContent2()
    {
        return '
            <div class="prose max-w-none">
                <p>Google Search Console продолжает развиваться, предоставляя веб-мастерам все более мощные инструменты для анализа и оптимизации сайтов. Рассмотрим новые возможности, которые появились в платформе.</p>

                <h2>Новые отчеты и функции</h2>
                <p>Среди главных нововведений можно выделить:</p>
                <ul>
                    <li><strong>Расширенный отчет по Core Web Vitals</strong> - более детальная аналитика производительности</li>
                    <li><strong>Улучшенный отчет по индексации</strong> - подробная информация о статусе страниц</li>
                    <li><strong>Новые фильтры в отчете по эффективности</strong> - более гибкая сегментация данных</li>
                    <li><strong>Интеграция с другими сервисами Google</strong> - связь с Analytics и Ads</li>
                </ul>

                <h2>Практическое применение</h2>
                <p>Новые функции позволяют:</p>
                <ol>
                    <li>Быстрее выявлять технические проблемы сайта</li>
                    <li>Отслеживать динамику ключевых метрик</li>
                    <li>Получать более точные данные о поисковом трафике</li>
                    <li>Эффективнее планировать SEO-стратегию</li>
                </ol>

                <h2>Рекомендации по использованию</h2>
                <p>Для максимальной эффективности рекомендуем регулярно проверять все разделы Search Console и настроить уведомления о критических ошибках.</p>
            </div>
        ';
    }

    private function getSeoNewsContent3()
    {
        return '
            <div class="prose max-w-none">
                <p>Яндекс анонсировал запуск нового фактора ранжирования, который специально разработан для оценки качества сайтов на мобильных устройствах. Это изменение затронет значительную часть поисковых запросов.</p>

                <h2>Суть нового фактора</h2>
                <p>Новый фактор ранжирования учитывает:</p>
                <ul>
                    <li><strong>Скорость загрузки на мобильных</strong> - время отображения контента</li>
                    <li><strong>Удобство навигации</strong> - размер кнопок, читаемость текста</li>
                    <li><strong>Адаптивность дизайна</strong> - корректное отображение на разных экранах</li>
                    <li><strong>Интерактивность</strong> - скорость реакции на действия пользователя</li>
                </ul>

                <h2>Влияние на ранжирование</h2>
                <p>Согласно данным Яндекса, новый фактор может повлиять на позиции до 30% сайтов в мобильной выдаче. Особенно это коснется:</p>
                <ol>
                    <li>Интернет-магазинов</li>
                    <li>Новостных порталов</li>
                    <li>Сайтов услуг</li>
                    <li>Информационных ресурсов</li>
                </ol>

                <h2>Что делать веб-мастерам</h2>
                <p>Для адаптации к новому фактору необходимо провести аудит мобильной версии сайта и устранить выявленные проблемы с производительностью и удобством использования.</p>
            </div>
        ';
    }

    private function getAnalyticsContent1()
    {
        return '
            <div class="prose max-w-none">
                <p>Google Analytics 4 кардинально отличается от Universal Analytics. В этом руководстве мы покажем, как правильно настроить GA4 для отслеживания SEO-метрик и анализа эффективности органического трафика.</p>

                <h2>Основные отличия GA4</h2>
                <p>GA4 использует событийную модель данных, что позволяет:</p>
                <ul>
                    <li><strong>Более гибко настраивать отслеживание</strong> - кастомные события и параметры</li>
                    <li><strong>Лучше понимать пользовательские пути</strong> - сквозная аналитика</li>
                    <li><strong>Интегрироваться с другими платформами</strong> - Google Ads, Search Console</li>
                    <li><strong>Использовать машинное обучение</strong> - предиктивная аналитика</li>
                </ul>

                <h2>Пошаговая настройка для SEO</h2>
                <ol>
                    <li><strong>Создание ресурса GA4</strong> - настройка базовых параметров</li>
                    <li><strong>Установка тега</strong> - через Google Tag Manager или напрямую</li>
                    <li><strong>Настройка целей</strong> - конверсии для SEO-трафика</li>
                    <li><strong>Создание аудиторий</strong> - сегментация органических пользователей</li>
                    <li><strong>Настройка отчетов</strong> - кастомные дашборды для SEO</li>
                </ol>

                <h2>Ключевые метрики для SEO</h2>
                <p>В GA4 особое внимание следует уделить:</p>
                <ul>
                    <li>Органическому трафику по каналам</li>
                    <li>Поведенческим метрикам (время на сайте, глубина просмотра)</li>
                    <li>Конверсиям из органического поиска</li>
                    <li>Анализу посадочных страниц</li>
                </ul>
            </div>
        ';
    }

    private function getAnalyticsContent2()
    {
        return '
            <div class="prose max-w-none">
                <p>Эффективность SEO-кампаний можно оценить по множеству показателей. Мы собрали 10 ключевых метрик, которые дают полную картину успешности вашей SEO-стратегии.</p>

                <h2>Метрики видимости</h2>
                <ol>
                    <li><strong>Позиции в поисковой выдаче</strong> - средние позиции по целевым запросам</li>
                    <li><strong>Органический трафик</strong> - количество посетителей из поиска</li>
                    <li><strong>Импрессии</strong> - количество показов в поисковой выдаче</li>
                    <li><strong>CTR</strong> - кликабельность сниппетов в выдаче</li>
                </ol>

                <h2>Метрики качества трафика</h2>
                <ol start="5">
                    <li><strong>Время на сайте</strong> - вовлеченность органических пользователей</li>
                    <li><strong>Показатель отказов</strong> - процент одностраничных сессий</li>
                    <li><strong>Глубина просмотра</strong> - среднее количество страниц за сессию</li>
                    <li><strong>Конверсии</strong> - достижение целей сайта</li>
                </ol>

                <h2>Технические метрики</h2>
                <ol start="9">
                    <li><strong>Core Web Vitals</strong> - показатели производительности сайта</li>
                    <li><strong>Индексация</strong> - процент проиндексированных страниц</li>
                </ol>

                <h2>Как использовать метрики</h2>
                <p>Для эффективного анализа рекомендуем:</p>
                <ul>
                    <li>Отслеживать динамику показателей в времени</li>
                    <li>Сравнивать метрики с конкурентами</li>
                    <li>Анализировать корреляции между показателями</li>
                    <li>Фокусироваться на метриках, влияющих на бизнес-цели</li>
                </ul>
            </div>
        ';
    }

    private function getAnalyticsContent3()
    {
        return '
            <div class="prose max-w-none">
                <p>Анализ конкурентов - важная часть SEO-стратегии. Правильно проведенный анализ поможет выявить возможности для роста и избежать ошибок конкурентов.</p>

                <h2>Инструменты для анализа</h2>
                <p>Основные инструменты для анализа конкурентов:</p>
                <ul>
                    <li><strong>SEMrush</strong> - комплексный анализ органического трафика</li>
                    <li><strong>Ahrefs</strong> - исследование ключевых слов и ссылок</li>
                    <li><strong>SimilarWeb</strong> - анализ трафика и источников</li>
                    <li><strong>Serpstat</strong> - отечественный инструмент для анализа</li>
                </ul>

                <h2>Методика анализа</h2>
                <ol>
                    <li><strong>Определение конкурентов</strong> - прямые и косвенные конкуренты</li>
                    <li><strong>Анализ ключевых слов</strong> - по каким запросам ранжируются конкуренты</li>
                    <li><strong>Изучение контент-стратегии</strong> - типы и форматы контента</li>
                    <li><strong>Анализ технических аспектов</strong> - структура сайта, скорость загрузки</li>
                    <li><strong>Исследование ссылочного профиля</strong> - источники внешних ссылок</li>
                </ol>

                <h2>Практическое применение</h2>
                <p>Результаты анализа помогают:</p>
                <ul>
                    <li>Найти новые возможности для ключевых слов</li>
                    <li>Улучшить контент-стратегию</li>
                    <li>Выявить технические проблемы</li>
                    <li>Спланировать линкбилдинг</li>
                </ul>

                <h2>Частота анализа</h2>
                <p>Рекомендуем проводить полный анализ конкурентов раз в квартал, а мониторинг ключевых показателей - ежемесячно.</p>
            </div>
        ';
    }

    private function getTipsContent1()
    {
        return '
            <div class="prose max-w-none">
                <p>Скорость загрузки сайта критически важна как для SEO, так и для пользовательского опыта. Медленные сайты теряют посетителей и позиции в поисковой выдаче. Вот 15 проверенных способов ускорить ваш сайт.</p>

                <h2>Оптимизация изображений</h2>
                <ol>
                    <li><strong>Сжимайте изображения</strong> - используйте форматы WebP, AVIF</li>
                    <li><strong>Правильные размеры</strong> - не загружайте изображения больше необходимого</li>
                    <li><strong>Ленивая загрузка</strong> - загружайте изображения по мере необходимости</li>
                </ol>

                <h2>Оптимизация кода</h2>
                <ol start="4">
                    <li><strong>Минификация CSS и JS</strong> - удалите лишние пробелы и комментарии</li>
                    <li><strong>Объединение файлов</strong> - уменьшите количество HTTP-запросов</li>
                    <li><strong>Удаление неиспользуемого кода</strong> - очистите CSS и JavaScript</li>
                </ol>

                <h2>Серверная оптимизация</h2>
                <ol start="7">
                    <li><strong>Качественный хостинг</strong> - выберите быстрый сервер</li>
                    <li><strong>CDN</strong> - используйте сеть доставки контента</li>
                    <li><strong>Кэширование</strong> - настройте браузерное и серверное кэширование</li>
                    <li><strong>Gzip-сжатие</strong> - сжимайте передаваемые данные</li>
                </ol>

                <h2>Техническая оптимизация</h2>
                <ol start="11">
                    <li><strong>HTTP/2</strong> - используйте современный протокол</li>
                    <li><strong>Предзагрузка ресурсов</strong> - загружайте критические ресурсы заранее</li>
                    <li><strong>Оптимизация шрифтов</strong> - используйте системные шрифты или оптимизируйте загрузку</li>
                    <li><strong>Уменьшение редиректов</strong> - минимизируйте количество перенаправлений</li>
                    <li><strong>Оптимизация базы данных</strong> - регулярно очищайте и оптимизируйте БД</li>
                </ol>

                <h2>Инструменты для проверки</h2>
                <p>Используйте эти инструменты для контроля скорости:</p>
                <ul>
                    <li>Google PageSpeed Insights</li>
                    <li>GTmetrix</li>
                    <li>WebPageTest</li>
                    <li>Lighthouse</li>
                </ul>
            </div>
        ';
    }

    private function getTipsContent2()
    {
        return '
            <div class="prose max-w-none">
                <p>Создание SEO-текста - это искусство балансирования между требованиями поисковых систем и потребностями пользователей. В этой статье мы поделимся секретами написания контента, который будет эффективен для SEO и интересен читателям.</p>

                <h2>Исследование ключевых слов</h2>
                <p>Прежде чем писать текст, необходимо:</p>
                <ul>
                    <li><strong>Определить основные запросы</strong> - 1-2 главных ключевых слова</li>
                    <li><strong>Собрать дополнительные запросы</strong> - синонимы и связанные фразы</li>
                    <li><strong>Изучить конкурентов</strong> - как они используют ключевые слова</li>
                    <li><strong>Проанализировать интент</strong> - что ищут пользователи</li>
                </ul>

                <h2>Структура SEO-текста</h2>
                <ol>
                    <li><strong>Заголовок (H1)</strong> - включите основное ключевое слово</li>
                    <li><strong>Введение</strong> - заинтересуйте читателя и обозначьте проблему</li>
                    <li><strong>Подзаголовки (H2-H6)</strong> - структурируйте контент логично</li>
                    <li><strong>Основная часть</strong> - раскройте тему полно и глубоко</li>
                    <li><strong>Заключение</strong> - подведите итоги и дайте четкий вывод</li>
                </ol>

                <h2>Правила использования ключевых слов</h2>
                <ul>
                    <li><strong>Естественность</strong> - ключевые слова должны вписываться органично</li>
                    <li><strong>Разнообразие</strong> - используйте синонимы и вариации</li>
                    <li><strong>Плотность</strong> - 1-3% от общего объема текста</li>
                    <li><strong>Размещение</strong> - в заголовках, первом абзаце, подзаголовках</li>
                </ul>

                <h2>Советы для улучшения качества</h2>
                <p>Чтобы текст был полезным для пользователей:</p>
                <ol>
                    <li>Отвечайте на реальные вопросы аудитории</li>
                    <li>Используйте примеры и кейсы</li>
                    <li>Добавляйте списки и таблицы для лучшего восприятия</li>
                    <li>Пишите простым и понятным языком</li>
                    <li>Проверяйте факты и добавляйте ссылки на источники</li>
                </ol>
            </div>
        ';
    }

    private function getTipsContent3()
    {
        return '
            <div class="prose max-w-none">
                <p>Внутренняя перелинковка - мощный инструмент SEO, который помогает поисковым системам лучше понимать структуру сайта, а пользователям - легче находить нужную информацию.</p>

                <h2>Принципы эффективной перелинковки</h2>
                <ul>
                    <li><strong>Релевантность</strong> - ссылки должны быть тематически связаны</li>
                    <li><strong>Естественность</strong> - ссылки вписываются в контекст</li>
                    <li><strong>Полезность</strong> - ссылки помогают пользователю</li>
                    <li><strong>Иерархичность</strong> - важные страницы получают больше ссылок</li>
                </ul>

                <h2>Типы внутренних ссылок</h2>
                <ol>
                    <li><strong>Навигационные</strong> - меню, хлебные крошки, пагинация</li>
                    <li><strong>Контекстные</strong> - ссылки в тексте статей</li>
                    <li><strong>Рекомендательные</strong> - блоки "Похожие статьи"</li>
                    <li><strong>Ссылки в сайдбаре и футере</strong> - дополнительная навигация</li>
                </ol>

                <h2>Стратегия перелинковки</h2>
                <p>Для создания эффективной системы перелинковки:</p>
                <ol>
                    <li><strong>Определите приоритетные страницы</strong> - какие страницы важнее всего</li>
                    <li><strong>Создайте карту ссылок</strong> - визуализируйте структуру</li>
                    <li><strong>Используйте анкоры с ключевыми словами</strong> - но не переспамьте</li>
                    <li><strong>Регулярно аудируйте ссылки</strong> - проверяйте на битые ссылки</li>
                </ol>

                <h2>Ошибки в перелинковке</h2>
                <p>Избегайте этих распространенных ошибок:</p>
                <ul>
                    <li>Слишком много ссылок на одной странице</li>
                    <li>Использование одинаковых анкоров</li>
                    <li>Ссылки на нерелевантные страницы</li>
                    <li>Игнорирование глубоких страниц</li>
                </ul>

                <h2>Инструменты для анализа</h2>
                <p>Используйте эти инструменты для анализа внутренней перелинковки:</p>
                <ul>
                    <li>Screaming Frog SEO Spider</li>
                    <li>Google Search Console</li>
                    <li>Ahrefs Site Explorer</li>
                    <li>SEMrush Site Audit</li>
                </ul>
            </div>
        ';
    }
}
